<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实践的思考与总结 | smallzip‘s Blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="smallzip 个人博客">
    <link rel="preload" href="/assets/css/0.styles.2fc78481.css" as="style"><link rel="preload" href="/assets/js/app.7d4f3de2.js" as="script"><link rel="preload" href="/assets/js/2.26b4ca92.js" as="script"><link rel="preload" href="/assets/js/41.23fba485.js" as="script"><link rel="prefetch" href="/assets/js/10.b317bce3.js"><link rel="prefetch" href="/assets/js/11.8ee6c761.js"><link rel="prefetch" href="/assets/js/12.53e9bc3d.js"><link rel="prefetch" href="/assets/js/13.d11e5bb2.js"><link rel="prefetch" href="/assets/js/14.1a7ac3aa.js"><link rel="prefetch" href="/assets/js/15.95ba698e.js"><link rel="prefetch" href="/assets/js/16.12cc2725.js"><link rel="prefetch" href="/assets/js/17.0c5dc206.js"><link rel="prefetch" href="/assets/js/18.a740cbf4.js"><link rel="prefetch" href="/assets/js/19.f3a4b9e9.js"><link rel="prefetch" href="/assets/js/20.cb81e1bb.js"><link rel="prefetch" href="/assets/js/21.30ba2eb0.js"><link rel="prefetch" href="/assets/js/22.9a57d305.js"><link rel="prefetch" href="/assets/js/23.f184478a.js"><link rel="prefetch" href="/assets/js/24.1a9da5cc.js"><link rel="prefetch" href="/assets/js/25.9c5fc5df.js"><link rel="prefetch" href="/assets/js/26.a05f5cb7.js"><link rel="prefetch" href="/assets/js/27.824f59c5.js"><link rel="prefetch" href="/assets/js/28.ddbde7dc.js"><link rel="prefetch" href="/assets/js/29.d5273140.js"><link rel="prefetch" href="/assets/js/3.b4eb5e10.js"><link rel="prefetch" href="/assets/js/30.6450fecd.js"><link rel="prefetch" href="/assets/js/31.aac633e0.js"><link rel="prefetch" href="/assets/js/32.0eee40b0.js"><link rel="prefetch" href="/assets/js/33.c0127169.js"><link rel="prefetch" href="/assets/js/34.403722d8.js"><link rel="prefetch" href="/assets/js/35.aa5041e5.js"><link rel="prefetch" href="/assets/js/36.985b8158.js"><link rel="prefetch" href="/assets/js/37.08e49cde.js"><link rel="prefetch" href="/assets/js/38.21290fcb.js"><link rel="prefetch" href="/assets/js/39.69a5f5a9.js"><link rel="prefetch" href="/assets/js/4.53121559.js"><link rel="prefetch" href="/assets/js/40.d8288902.js"><link rel="prefetch" href="/assets/js/42.c64155f7.js"><link rel="prefetch" href="/assets/js/43.3f9d03e3.js"><link rel="prefetch" href="/assets/js/44.d04f9b22.js"><link rel="prefetch" href="/assets/js/45.1791fee7.js"><link rel="prefetch" href="/assets/js/46.aa8ff59b.js"><link rel="prefetch" href="/assets/js/47.db1c8f44.js"><link rel="prefetch" href="/assets/js/48.c2e263aa.js"><link rel="prefetch" href="/assets/js/49.e6cb0744.js"><link rel="prefetch" href="/assets/js/5.f9da8c69.js"><link rel="prefetch" href="/assets/js/50.89c360b1.js"><link rel="prefetch" href="/assets/js/51.3aa0cc1e.js"><link rel="prefetch" href="/assets/js/52.4cb1b1f8.js"><link rel="prefetch" href="/assets/js/53.f5ce2d95.js"><link rel="prefetch" href="/assets/js/54.d31076f1.js"><link rel="prefetch" href="/assets/js/55.cdaa4e53.js"><link rel="prefetch" href="/assets/js/56.4cb18d0b.js"><link rel="prefetch" href="/assets/js/57.41f6c005.js"><link rel="prefetch" href="/assets/js/58.40a34bf6.js"><link rel="prefetch" href="/assets/js/59.58bc3b05.js"><link rel="prefetch" href="/assets/js/6.1a146ec0.js"><link rel="prefetch" href="/assets/js/60.93d31dd5.js"><link rel="prefetch" href="/assets/js/61.ddb5fc0c.js"><link rel="prefetch" href="/assets/js/62.d4f15634.js"><link rel="prefetch" href="/assets/js/63.f9284901.js"><link rel="prefetch" href="/assets/js/64.ceaab1d0.js"><link rel="prefetch" href="/assets/js/65.443d5ce9.js"><link rel="prefetch" href="/assets/js/66.11b7fa9d.js"><link rel="prefetch" href="/assets/js/67.d4b48018.js"><link rel="prefetch" href="/assets/js/7.920bce8f.js"><link rel="prefetch" href="/assets/js/8.3fcb3827.js"><link rel="prefetch" href="/assets/js/9.2da28544.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fc78481.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">smallzip‘s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/e0d0e6cb34d2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/5a68b1945188256922633d02" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/jianpiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/e0d0e6cb34d2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/5a68b1945188256922633d02" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/jianpiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/《javascript高级程序设计》笔记.html" class="sidebar-link">《javascript高级程序设计》笔记</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript技术积累</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/linux笔记.html" class="sidebar-link">linux笔记</a></li><li><a href="/linux课堂代码案例.html" class="sidebar-link">linux课堂代码案例</a></li><li><a href="/算法学习笔记.html" class="sidebar-link">算法学习笔记</a></li><li><a href="/js数据结构与算法.html" class="sidebar-link">js数据结构与算法</a></li><li><a href="/javascript设计模式.html" class="sidebar-link">javascript设计模式</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>phaser游戏引擎</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/phaser/红包雨.html" class="sidebar-link">红包雨</a></li><li><a href="/phaser/消消乐.html" class="sidebar-link">消消乐</a></li><li><a href="/phaser/摘星星.html" class="sidebar-link">Phaser游戏引擎初体验</a></li><li><a href="/phaser/实践与总结.html" class="active sidebar-link">实践的思考与总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/phaser/实践与总结.html#物理引擎" class="sidebar-link">物理引擎</a></li><li class="sidebar-sub-header"><a href="/phaser/实践与总结.html#sprite和group用作容器的异同" class="sidebar-link">Sprite和Group用作容器的异同</a></li><li class="sidebar-sub-header"><a href="/phaser/实践与总结.html#解决低端设备卡顿的问题" class="sidebar-link">解决低端设备卡顿的问题</a></li><li class="sidebar-sub-header"><a href="/phaser/实践与总结.html#sprite层级" class="sidebar-link">Sprite层级</a></li><li class="sidebar-sub-header"><a href="/phaser/实践与总结.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/phaser/实践与总结.html#参考文献" class="sidebar-link">参考文献</a></li></ul></li></ul></section></li><li><a href="/了解HTTP.html" class="sidebar-link">了解HTTP</a></li><li><a href="/Flutter学习笔记.html" class="sidebar-link">Flutter学习笔记</a></li><li><a href="/css学习笔记.html" class="sidebar-link">css学习笔记</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React记录</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/React-Native.html" class="sidebar-link">React-Native记录</a></li><li><a href="/小程序记录.html" class="sidebar-link">小程序笔记</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/js正则积累.html" class="sidebar-link">js正则积累</a></li><li><a href="/前端题目练习.html" class="sidebar-link">前端题目练习</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器端积累</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/计算机基础.html" class="sidebar-link">计算机基础</a></li><li><a href="/网络基础知识.html" class="sidebar-link">网络基础</a></li><li><a href="/基础面试要点知识.html" class="sidebar-link">基础面试知识积累</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="实践的思考与总结"><a href="#实践的思考与总结" class="header-anchor">#</a> 实践的思考与总结</h1> <p>Phaser游戏开发过程中，会遇到很多稀奇古怪的小问题，最后能够迎刃而解，少不了日常踩坑的思考以及最后给出解决方案。在这里总结一下。</p> <h2 id="物理引擎"><a href="#物理引擎" class="header-anchor">#</a> 物理引擎</h2> <p>往期的游戏中，我们用到了<code>arcade</code>物理系统，实现摘星星中任务的跳跃、星星的摘取、炸弹的碰撞。也用到了<code>p2</code>物理系统，实现红包雨下落的重叠、不规则下落。此外还有另外一种物理系统 —— <code>Ninja</code>。它们三者有什么区别，在什么场景下使用最优，下面就来讲解一下。</p> <h3 id="物理系统"><a href="#物理系统" class="header-anchor">#</a> 物理系统</h3> <p>Phaser提供三种物理系统，它们分别是：</p> <ol><li>Arcade：街机物理处理系统。包含碰撞、重叠和运动相关的方法。</li> <li>P2：P2的物理系统。包含碰撞、重叠和运动相关的方法。</li> <li>Ninja：忍者物理系统。包含碰撞、重叠和运动相关的方法</li></ol> <h3 id="差异"><a href="#差异" class="header-anchor">#</a> 差异</h3> <p>Phaser包含了我们常用的<code>Arcade Physics</code>系统，以及<code>Ninja Physics</code>和<code>P2.JS</code>全身物理系统。</p> <p><code>Arcade Physics</code>（街机物理系统）仅适用于高速AABB碰撞。AABB表示轴对齐的有界矩形，这就意味着所有的碰撞都是基于一个矩阵边界来计算的，所以如果想碰撞一个圆形的精灵（sprite）碰撞的则是它的实际矩阵边界，而不是原型本身设定的边界，这就导致它无法实现非矩阵精灵的物理场景。此外它支持摩擦力、重力、弹跳、加速等物理属性，适合应用精度要求不高，较为简单的游戏物理场景中。（例子：摘星星使用了重叠和碰撞）。</p> <p><code>Ninja Physics</code>（忍者物理系统）允许使用复杂的砖块和坡度，特别适合水平舞台。<code>Arcade Physics</code>不适合旋转物理精灵，<code>Ninja Physics</code>弥补了它的缺陷，可以处理物理旋转，<code>Ninja Physics</code>可以使精灵倾斜和复杂的平铺，这是更加灵活（可能更准确）的物理模型，但缺点是计算比较慢。</p> <p><code>P2 Physics</code>是一个全身物理系统，具有约束，弹簧，多边形支撑等。如果游戏需要对弹簧力的约束（例如：摆钟左右摇晃摆动）以及任意多边形形状（例如：四面体）进行建模，它更符合需求。（例子：红包雨使用到了四面体建模，愤怒的小鸟使用到了弹簧和多面体建模）</p> <p>假如游戏中不需要用到复杂的物理动作，完全可以直接使用<code>Arcade Physics</code>，它使用简单，计算简单，性能消耗低。其他两个物理系统物理属性更为复杂且功能丰富，以性能消耗为代价。</p> <h3 id="物理属性"><a href="#物理属性" class="header-anchor">#</a> 物理属性</h3> <p>三个物理系统的物理属性API有些许差异，下面来介绍一下。</p> <p>每一种物理属性需要在create阶段启动，确保精灵创建之前能被分配到指定物理系统，否则会出现错误。</p> <blockquote><p>下面代码以arcade为例。</p> <p>如使用p2则改为：game.physics.startSystem(Phaser.Physics.P2JS);</p> <p>如使用Ninja则为：game.physics.startSystem(Phaser.Physics.Ninja);</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> game<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//开启物理引擎</span>
game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span><span class="token function">startSystem</span><span class="token punctuation">(</span>Phaser<span class="token punctuation">.</span>Physics<span class="token punctuation">.</span><span class="token constant">ARCADE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sprite<span class="token operator">=</span>game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//在sprite上启用arcade物理引擎</span>
game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>sprite<span class="token punctuation">,</span>Phaser<span class="token punctuation">.</span>Physics<span class="token punctuation">.</span><span class="token constant">ARCADE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="arcade物理属性"><a href="#arcade物理属性" class="header-anchor">#</a> Arcade物理属性</h4> <p>速度velocity属性。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>velocity<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>  <span class="token comment">//X轴的速度（正数往右，负数往左）</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>  <span class="token comment">//Y轴的速度（正数往下，负数往上）</span>
</code></pre></div><p>加速度acceleration属性。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>acceleration<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>  

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span> <span class="token comment">//X轴的加速度</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span> <span class="token comment">//Y轴的加速度</span>
</code></pre></div><p>阻力drag</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>drag<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>drag<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>drag<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>drag<span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>
</code></pre></div><p>重力gravity</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>gravity<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>gravity<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>gravity<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>gravity<span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>
</code></pre></div><p>弹跳bounce</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>bounce<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>bounce<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>bounce<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">;</span>

srpite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>bounce<span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token number">0.5</span>
</code></pre></div><p>其他属性</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>friction<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">//设置与其他物体接触时的摩擦力</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>rotation<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span>  <span class="token comment">//设置角度</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>immovable<span class="token operator">=</span><span class="token boolean">true</span> <span class="token comment">//设置该物体是固定的（true）还是不固定的（false）</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>mass<span class="token operator">=</span><span class="token number">10</span> <span class="token comment">//设置物体的相对质量，默认为1</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>maxVelocity<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span>  <span class="token comment">//设置最大速度</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>maxAngular<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>  <span class="token comment">//设置最大角速度</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span>height<span class="token punctuation">,</span>offsetX<span class="token punctuation">,</span>offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//设置body的范围</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>  <span class="token comment">//重置所有的物理属性</span>

sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>touching<span class="token punctuation">.</span>down 
sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>touching<span class="token punctuation">.</span>up  <span class="token comment">// 返回true/false，该物体的底部或顶部是否与其他物体接触</span>
</code></pre></div><h4 id="arcade碰撞"><a href="#arcade碰撞" class="header-anchor">#</a> Arcade碰撞</h4> <p>arcade只支持AABB（矩形）之间的碰撞检测，并且<code>overlap</code>方法不产生效果，所以，应该使用<code>collide</code>方法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> game<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> sprite1<span class="token operator">=</span>game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> sprite2<span class="token operator">=</span>game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>arcade<span class="token punctuation">.</span><span class="token function">collide</span><span class="token punctuation">(</span>sprite1<span class="token punctuation">,</span>sprite2<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// collide方法不仅会检测两个物体之间的碰撞，而且会产生碰撞的物理效果，而overlap不会产生碰撞效果</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>精灵与组的碰撞（摘星星游戏就是使用了这个碰撞方案）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> game<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> sprite<span class="token operator">=</span>game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> group<span class="token operator">=</span>game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//检测精灵与组之间的碰撞</span>
game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>arcade<span class="token punctuation">.</span><span class="token function">collide</span><span class="token punctuation">(</span>sprite<span class="token punctuation">,</span>group<span class="token punctuation">)</span>
</code></pre></div><p>组和组的碰撞</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> game<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Game</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> group<span class="token operator">=</span>game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//检测组内的元素的碰撞</span>
game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>arcade<span class="token punctuation">.</span><span class="token function">collide</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
</code></pre></div><h4 id="p2物理属性"><a href="#p2物理属性" class="header-anchor">#</a> P2物理属性</h4> <p>重力和速度</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>p2<span class="token punctuation">.</span>gravity<span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token number">50</span>   <span class="token comment">// 给所有物体添加重力加速度</span>
</code></pre></div><p>摩擦力</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>p2<span class="token punctuation">.</span>friction<span class="token operator">=</span><span class="token number">1</span>   <span class="token comment">// 碰撞物体间的摩擦力</span>
</code></pre></div><p>碰撞恢复</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>p2<span class="token punctuation">.</span>restitution<span class="token operator">=</span><span class="token number">0.8</span>  <span class="token comment">// 碰撞物体间的恢复系数</span>
</code></pre></div><p>碰撞检测</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 启动p2物理系统</span>
game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span><span class="token function">startSystem</span><span class="token punctuation">(</span>Phaser<span class="token punctuation">.</span>Phaser<span class="token punctuation">.</span><span class="token constant">P2JS</span><span class="token punctuation">)</span>

<span class="token comment">// 打开影响事件的世界，如果没有设置为true，我们不能得到碰撞回调   </span>
game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>p2<span class="token punctuation">.</span><span class="token function">setImpactEvents</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建碰撞组</span>
<span class="token keyword">const</span> collisionGroup1<span class="token operator">=</span>game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>p2<span class="token punctuation">.</span><span class="token function">createCollisionGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> collisionGtoup2<span class="token operator">=</span>game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>p2<span class="token punctuation">.</span><span class="token function">createCollisionGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果我们监听自己的碰撞，必须调用此来更新碰撞组</span>
game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>p2<span class="token punctuation">.</span><span class="token function">updateBoundsCollisionGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> sprite1<span class="token operator">=</span>game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sprite2<span class="token operator">=</span>game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 保证物体启动物理特性</span>
game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>p2<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>sprite1<span class="token punctuation">)</span><span class="token punctuation">;</span>   

<span class="token comment">//给物体添加collisionGroup1碰撞组 </span>
sprite1<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setCollisionGroup</span><span class="token punctuation">(</span>collisionGroup1<span class="token punctuation">)</span>  
sprite1<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">collides</span><span class="token punctuation">(</span>collisionGroup2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ninja物理属性"><a href="#ninja物理属性" class="header-anchor">#</a> Ninja物理属性</h4> <p><code>Ninja</code>的属性特别多，不仅包含了<code>Arcade</code>的所有属性，额外多出来好几十种物理属性，所以这里不做一一介绍了，可以参考<a href="https://www.w3cschool.cn/doc_phaser/phaser-phaser-physics-ninja.html?lang=en" target="_blank" rel="noopener noreferrer">Ninjs物理属性列表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="sprite和group用作容器的异同"><a href="#sprite和group用作容器的异同" class="header-anchor">#</a> Sprite和Group用作容器的异同</h2> <p>我们经常会用到容器的概念，在Phaser中，最常用作容器的就是<code>Group</code>和<code>Sprite</code>。<code>Word</code>就是游戏中最底层的一个容器。</p> <h3 id="添加子对象的方法"><a href="#添加子对象的方法" class="header-anchor">#</a> 添加子对象的方法</h3> <p><code>Sprite</code>常用方法是<code>addChild()</code></p> <p><code>Group</code>添加子对象的方法很多个，如<code>add()</code>、<code>addChild()</code>、<code>create()</code></p> <h3 id="两者都继承了displayobjectcontainer"><a href="#两者都继承了displayobjectcontainer" class="header-anchor">#</a> 两者都继承了DisplayObjectContainer</h3> <p><code>Sprite</code>和<code>Group</code>的容器功能都继承自<code>DisplayObjectContainer</code>，但<code>DisplayObjectContainer</code>的一些原有的属性方法在<code>Sprite</code>中被重写了，比如<code>width</code>、<code>height</code>、<code>getBounds()</code>等；而<code>Group</code>则完整的继承了<code>DisplayObjectContainer</code>的属性方法，如果单纯作为容器使用，<code>Group</code>应该更合适，更专业。</p> <h3 id="关于textture和层级关系"><a href="#关于textture和层级关系" class="header-anchor">#</a> 关于TextTure和层级关系</h3> <p><code>Sprite</code>有自己的<code>texture</code>，显示内容将会在它所有<code>children</code>的最底层，相当于背景（根据先画的垫底，后画的在上的渲染规则，以及先有父才有子的关系，所以不难理解）</p> <p>而<code>Group</code> 没有自己的<code>texture</code>，他只是一个纯容器，如同空气没有显示的东西，所以他自身跟<code>children</code>没有显示上的层级关系，只有<code>children</code>们各自之间的层级关系。</p> <h3 id="与children的关系"><a href="#与children的关系" class="header-anchor">#</a> 与Children的关系</h3> <p><code>Sprite</code>作为容器，它的child一般是一个整体的一部分，比如一个飞机，可以有机身、机翼、螺旋桨，如果这些都是单独的素材，那么我们可以把飞机定义为一个<code>Sprite</code>，然后机身、机翼、螺旋桨作为它的孩子，通过<code>addChild</code>来加入。它的特点是共享父精灵的物理属性（比如位移、旋转），并且它们之间的相对位置固定。</p> <p>如果是一群飞机，这时候我们建议使用<code>Group</code>，每一个飞机都是独立个体，有自己的位移、旋转等，并且它们的相对位置并不固定，有时可以挨得很近，有时可以离得很远。</p> <h2 id="解决低端设备卡顿的问题"><a href="#解决低端设备卡顿的问题" class="header-anchor">#</a> 解决低端设备卡顿的问题</h2> <p>在低端的设计处理速度会比较慢，容易造成视觉卡顿现象。</p> <p>在Phaser中，可以通过设置<code>game.time.desiredFps</code>来解决，这个默认值是60FPS，但是在一些低端手机，会有些高，需要对游戏进行降频，降到30FPS。</p> <p>解决的方案是在一秒钟内计算<code>update</code>被调动的次数，如果很低，那么就调整<code>game.time.desiredFps</code>的值。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 一秒内刷新</span>
game<span class="token punctuation">.</span>time<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">loop</span><span class="token punctuation">(</span>Phaser<span class="token punctuation">.</span>Timer<span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>checkoutFPS<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 检查fps帧率</span>
<span class="token keyword">function</span> <span class="token function">checkoutFPS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>isSetTps<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fpsTestEnd<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>fpsCount <span class="token operator">&gt;=</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      game<span class="token punctuation">.</span>time<span class="token punctuation">.</span>desiredFps <span class="token operator">=</span> <span class="token number">60</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      game<span class="token punctuation">.</span>time<span class="token punctuation">.</span>desiredFps <span class="token operator">=</span> fpsCount <span class="token operator">+</span> <span class="token number">5</span>
      isSetTps <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    fpsCount<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="sprite层级"><a href="#sprite层级" class="header-anchor">#</a> Sprite层级</h2> <p><code>sprite</code>的层级是由<code>sprite</code>创建顺序决定的，<code>sprite</code>创建顺序越往后层级越高（越在上面）。</p> <p>可能有人有这样的场景，后面的是动态添加的，只能后添加，却希望它在最底层。那么这时候只需要调用<code>sprite</code>中的<code>bringToTop</code>，它可以将某一个<code>sprite</code>拉到最高层。</p> <p>同理，还有<code>sendToBack</code>，它可以将精灵放到最低层。</p> <p>但是要注意，通过这种方式调整层级顺序，精灵必须位于同一个组内，也就是他们互为兄弟节点。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>以上是在游戏开发过程遇到的问题，以及最后的解决方案。</p> <p>开发游戏是一个艰辛而又有乐趣的过程，享受游戏一步一步制作的乐趣，它不像软件应用，做出来各个流程体验一下就过去了，游戏可以反复把玩，设定各种难度和关卡，一步一步登天。</p> <h2 id="参考文献"><a href="#参考文献" class="header-anchor">#</a> 参考文献</h2> <p><a href="http://club.phaser-china.com/?tab=good" target="_blank" rel="noopener noreferrer">phaser社区<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/12/2022, 5:47:05 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/phaser/摘星星.html" class="prev">
        Phaser游戏引擎初体验
      </a></span> <span class="next"><a href="/了解HTTP.html">
        了解HTTP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7d4f3de2.js" defer></script><script src="/assets/js/2.26b4ca92.js" defer></script><script src="/assets/js/41.23fba485.js" defer></script>
  </body>
</html>
