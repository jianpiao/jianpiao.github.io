<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>红包雨 | smallzip‘s Blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="smallzip 个人博客">
    <link rel="preload" href="/assets/css/0.styles.2fc78481.css" as="style"><link rel="preload" href="/assets/js/app.7d4f3de2.js" as="script"><link rel="preload" href="/assets/js/2.26b4ca92.js" as="script"><link rel="preload" href="/assets/js/44.d04f9b22.js" as="script"><link rel="prefetch" href="/assets/js/10.b317bce3.js"><link rel="prefetch" href="/assets/js/11.8ee6c761.js"><link rel="prefetch" href="/assets/js/12.53e9bc3d.js"><link rel="prefetch" href="/assets/js/13.d11e5bb2.js"><link rel="prefetch" href="/assets/js/14.1a7ac3aa.js"><link rel="prefetch" href="/assets/js/15.95ba698e.js"><link rel="prefetch" href="/assets/js/16.12cc2725.js"><link rel="prefetch" href="/assets/js/17.0c5dc206.js"><link rel="prefetch" href="/assets/js/18.a740cbf4.js"><link rel="prefetch" href="/assets/js/19.f3a4b9e9.js"><link rel="prefetch" href="/assets/js/20.cb81e1bb.js"><link rel="prefetch" href="/assets/js/21.30ba2eb0.js"><link rel="prefetch" href="/assets/js/22.9a57d305.js"><link rel="prefetch" href="/assets/js/23.f184478a.js"><link rel="prefetch" href="/assets/js/24.1a9da5cc.js"><link rel="prefetch" href="/assets/js/25.9c5fc5df.js"><link rel="prefetch" href="/assets/js/26.a05f5cb7.js"><link rel="prefetch" href="/assets/js/27.824f59c5.js"><link rel="prefetch" href="/assets/js/28.ddbde7dc.js"><link rel="prefetch" href="/assets/js/29.d5273140.js"><link rel="prefetch" href="/assets/js/3.b4eb5e10.js"><link rel="prefetch" href="/assets/js/30.6450fecd.js"><link rel="prefetch" href="/assets/js/31.aac633e0.js"><link rel="prefetch" href="/assets/js/32.0eee40b0.js"><link rel="prefetch" href="/assets/js/33.c0127169.js"><link rel="prefetch" href="/assets/js/34.403722d8.js"><link rel="prefetch" href="/assets/js/35.aa5041e5.js"><link rel="prefetch" href="/assets/js/36.985b8158.js"><link rel="prefetch" href="/assets/js/37.08e49cde.js"><link rel="prefetch" href="/assets/js/38.21290fcb.js"><link rel="prefetch" href="/assets/js/39.69a5f5a9.js"><link rel="prefetch" href="/assets/js/4.53121559.js"><link rel="prefetch" href="/assets/js/40.d8288902.js"><link rel="prefetch" href="/assets/js/41.23fba485.js"><link rel="prefetch" href="/assets/js/42.c64155f7.js"><link rel="prefetch" href="/assets/js/43.3f9d03e3.js"><link rel="prefetch" href="/assets/js/45.1791fee7.js"><link rel="prefetch" href="/assets/js/46.aa8ff59b.js"><link rel="prefetch" href="/assets/js/47.db1c8f44.js"><link rel="prefetch" href="/assets/js/48.c2e263aa.js"><link rel="prefetch" href="/assets/js/49.e6cb0744.js"><link rel="prefetch" href="/assets/js/5.f9da8c69.js"><link rel="prefetch" href="/assets/js/50.89c360b1.js"><link rel="prefetch" href="/assets/js/51.3aa0cc1e.js"><link rel="prefetch" href="/assets/js/52.4cb1b1f8.js"><link rel="prefetch" href="/assets/js/53.f5ce2d95.js"><link rel="prefetch" href="/assets/js/54.d31076f1.js"><link rel="prefetch" href="/assets/js/55.cdaa4e53.js"><link rel="prefetch" href="/assets/js/56.4cb18d0b.js"><link rel="prefetch" href="/assets/js/57.41f6c005.js"><link rel="prefetch" href="/assets/js/58.40a34bf6.js"><link rel="prefetch" href="/assets/js/59.58bc3b05.js"><link rel="prefetch" href="/assets/js/6.1a146ec0.js"><link rel="prefetch" href="/assets/js/60.93d31dd5.js"><link rel="prefetch" href="/assets/js/61.ddb5fc0c.js"><link rel="prefetch" href="/assets/js/62.d4f15634.js"><link rel="prefetch" href="/assets/js/63.f9284901.js"><link rel="prefetch" href="/assets/js/64.ceaab1d0.js"><link rel="prefetch" href="/assets/js/65.443d5ce9.js"><link rel="prefetch" href="/assets/js/66.11b7fa9d.js"><link rel="prefetch" href="/assets/js/67.d4b48018.js"><link rel="prefetch" href="/assets/js/7.920bce8f.js"><link rel="prefetch" href="/assets/js/8.3fcb3827.js"><link rel="prefetch" href="/assets/js/9.2da28544.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2fc78481.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">smallzip‘s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/e0d0e6cb34d2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/5a68b1945188256922633d02" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/jianpiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="https://www.jianshu.com/u/e0d0e6cb34d2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简书
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/5a68b1945188256922633d02" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/jianpiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/《javascript高级程序设计》笔记.html" class="sidebar-link">《javascript高级程序设计》笔记</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript技术积累</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/linux笔记.html" class="sidebar-link">linux笔记</a></li><li><a href="/linux课堂代码案例.html" class="sidebar-link">linux课堂代码案例</a></li><li><a href="/算法学习笔记.html" class="sidebar-link">算法学习笔记</a></li><li><a href="/js数据结构与算法.html" class="sidebar-link">js数据结构与算法</a></li><li><a href="/javascript设计模式.html" class="sidebar-link">javascript设计模式</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>phaser游戏引擎</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/phaser/红包雨.html" class="active sidebar-link">红包雨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/phaser/红包雨.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/phaser/红包雨.html#目标" class="sidebar-link">目标</a></li><li class="sidebar-sub-header"><a href="/phaser/红包雨.html#红包雨游戏" class="sidebar-link">红包雨游戏</a></li><li class="sidebar-sub-header"><a href="/phaser/红包雨.html#游戏核心概括" class="sidebar-link">游戏核心概括</a></li><li class="sidebar-sub-header"><a href="/phaser/红包雨.html#游戏环境搭建" class="sidebar-link">游戏环境搭建</a></li><li class="sidebar-sub-header"><a href="/phaser/红包雨.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/phaser/红包雨.html#参考文献" class="sidebar-link">参考文献</a></li></ul></li><li><a href="/phaser/消消乐.html" class="sidebar-link">消消乐</a></li><li><a href="/phaser/摘星星.html" class="sidebar-link">Phaser游戏引擎初体验</a></li><li><a href="/phaser/实践与总结.html" class="sidebar-link">实践的思考与总结</a></li></ul></section></li><li><a href="/了解HTTP.html" class="sidebar-link">了解HTTP</a></li><li><a href="/Flutter学习笔记.html" class="sidebar-link">Flutter学习笔记</a></li><li><a href="/css学习笔记.html" class="sidebar-link">css学习笔记</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React记录</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/React-Native.html" class="sidebar-link">React-Native记录</a></li><li><a href="/小程序记录.html" class="sidebar-link">小程序笔记</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/js正则积累.html" class="sidebar-link">js正则积累</a></li><li><a href="/前端题目练习.html" class="sidebar-link">前端题目练习</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器端积累</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/计算机基础.html" class="sidebar-link">计算机基础</a></li><li><a href="/网络基础知识.html" class="sidebar-link">网络基础</a></li><li><a href="/基础面试要点知识.html" class="sidebar-link">基础面试知识积累</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="红包雨"><a href="#红包雨" class="header-anchor">#</a> 红包雨</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>双十一各大购物平台开启了红包雨活动，点击红包即可获得相对应金额奖励。</p> <p>那我们能不能自己实现一个红包雨游戏，以后适当时期加入到光环社区活动中呢？</p> <h2 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h2> <p>红包雨能够支持PC端、移动端落地页投放，游戏尺寸能够适配各种设备。</p> <p><strong>游戏规则</strong></p> <ul><li>红包会从页面顶部随机数量、位置落下</li> <li>点击下落的红包弹出点击反馈动画</li> <li>游戏时长为20秒钟</li> <li>游戏结束可以领取奖励</li></ul> <h2 id="红包雨游戏"><a href="#红包雨游戏" class="header-anchor">#</a> 红包雨游戏</h2> <p>这里以phaser2版本作为游戏开发基础。</p> <h2 id="游戏核心概括"><a href="#游戏核心概括" class="header-anchor">#</a> 游戏核心概括</h2> <p>游戏最核心的部分如下：</p> <h3 id="_1-引擎系统"><a href="#_1-引擎系统" class="header-anchor">#</a> 1. 引擎系统</h3> <p>这次红包雨用到的是<strong>arcade</strong>物理引擎，它包含碰撞、重叠、运动相关的方法。</p> <p>红包雨下落需要用到物理属性如下：</p> <p><strong>速度velocity属性</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>redPacket<span class="token punctuation">.</span>body<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">=</span> game<span class="token punctuation">.</span>rnd<span class="token punctuation">.</span><span class="token function">integerInRange</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//红包移动的速度</span>
redPacket<span class="token punctuation">.</span>body<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">=</span> game<span class="token punctuation">.</span>rnd<span class="token punctuation">.</span><span class="token function">integerInRange</span><span class="token punctuation">(</span>gameOptions<span class="token punctuation">.</span>minSpeed<span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>maxSpeed<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>重力gravity</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>arcade<span class="token punctuation">.</span>gravity<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-红包精灵-sprite"><a href="#_2-红包精灵-sprite" class="header-anchor">#</a> 2. 红包精灵(sprite)</h3> <p>红包是属于<code>sprite</code>精灵元素，它可以有物理属性。</p> <p>红包由<code>spritesheet</code>加载生成，它被切分成为两帧动画。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">spritesheet</span><span class="token punctuation">(</span><span class="token string">'redpacket'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/redpacket.png'</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 红包，两帧</span>
</code></pre></div><p>红包默认显示第一帧动画，当点击之后，切换显示第二帧</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 给红包添加帧动画</span>
<span class="token keyword">let</span> anim <span class="token operator">=</span> sprite<span class="token punctuation">.</span>animations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>gameOptions<span class="token punctuation">.</span>selfPic<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 执行帧动画</span>
sprite<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>gameOptions<span class="token punctuation">.</span>selfPic<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 帧动画切换完毕后，执行补间动画，让红包渐变消失</span>
anim<span class="token punctuation">.</span>onComplete<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>killed<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> sprite<span class="token punctuation">)</span>
</code></pre></div><h2 id="游戏环境搭建"><a href="#游戏环境搭建" class="header-anchor">#</a> 游戏环境搭建</h2> <p>使用的phaser2版本，红包雨用到了<code>arcade</code>物理引擎，需要额外引入pixi.js和p2.js。</p> <p>本次新增了两个音效，一个是游戏进行中的背景音，一个是开奖音效。在项目中直接使用<code>audio</code>的原生API进行播放、暂停、重新播放。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;icon&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;image/svg+xml&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;favicon.svg&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=750,minimum-scale=0.5,maximum-scale=0.5,initial-scale=0.5&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>红包雨<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>audio id<span class="token operator">=</span><span class="token string">&quot;audioOpen&quot;</span> src<span class="token operator">=</span><span class="token string">'assets/audio/open-redpacket.mp3'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>audio<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>audio id<span class="token operator">=</span><span class="token string">&quot;playing&quot;</span> src<span class="token operator">=</span><span class="token string">'assets/audio/playing.mp3'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>audio<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'./js/pixi.js'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'./js/p2.js'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'./js/phaser-split.js'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;app.js&quot;</span> charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;/main.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><p>基础内容加载完毕后，开始实例化并启动游戏。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">'./style.css'</span>

<span class="token comment">// 游戏主体</span>
<span class="token keyword">let</span> game<span class="token punctuation">;</span>

<span class="token comment">// 游戏基本配置,用于创建游戏画布</span>
<span class="token keyword">const</span> gameOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  gameWidth<span class="token operator">:</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span>
  gameHeight<span class="token operator">:</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">,</span>
  renderer<span class="token operator">:</span> Phaser<span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">,</span>
  parent<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'gameScreen'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  selfPool<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  selfPic<span class="token operator">:</span> <span class="token string">'redpacket'</span><span class="token punctuation">,</span>
  rate<span class="token operator">:</span> <span class="token number">0.15</span><span class="token punctuation">,</span>
  maxSpeed<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  minSpeed<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
  max<span class="token operator">:</span> <span class="token number">95</span><span class="token punctuation">,</span>
  time<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">// 游戏时长</span>
  awardText<span class="token operator">:</span> <span class="token string">&quot;恭喜获得女票一位&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 让它在页面加载后执行</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> gameWidth<span class="token punctuation">,</span> gameHeight<span class="token punctuation">,</span> renderer<span class="token punctuation">,</span> parent <span class="token punctuation">}</span> <span class="token operator">=</span> gameOptions

  <span class="token comment">// 使用Phaser引擎创建一个游戏</span>
  game <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Game</span><span class="token punctuation">(</span>gameWidth<span class="token punctuation">,</span> gameHeight<span class="token punctuation">,</span> renderer<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 添加游戏</span>
  game<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;TheGame&quot;</span><span class="token punctuation">,</span> TheGame<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 启动游戏</span>
  game<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;TheGame&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>把游戏添加到<code>state</code>场景中，然后将场景中的游戏启动。</p> <h3 id="预加载资源"><a href="#预加载资源" class="header-anchor">#</a> 预加载资源</h3> <p>搭建舞台场景，设置舞台的背景色（后面添加背景图会覆盖掉）。</p> <p>加载瓦片的资源，游戏中用到所有资源在此逐一加载。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// 资源预加载，会在phaser预加载期间执行，可以实时监控资源加载的进度</span>
  <span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token constant">GAME</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>load<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token constant">GAME</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 将游戏覆盖整个屏幕，同时保持其比例</span>
    game<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>scaleMode <span class="token operator">=</span> Phaser<span class="token punctuation">.</span>ScaleManager<span class="token punctuation">.</span><span class="token constant">SHOW_ALL</span><span class="token punctuation">;</span>

    <span class="token comment">// 游戏水平居中</span>
    game<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>pageAlignHorizontally <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// 游戏垂直居中</span>
    game<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>pageAlignVertically <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置舞台背景色</span>
    game<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">'#000'</span><span class="token punctuation">;</span>

    <span class="token comment">//加载图片</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'launchBg'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/bg-plan.jpg'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'bgRainer'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/bg-rainer.jpg'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">spritesheet</span><span class="token punctuation">(</span><span class="token string">'redpacket'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/redpacket.png'</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 红包，两帧</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/close.png'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'dialogExit'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/dialog-exit.png'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'buttonExit'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/button-exit.png'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'buttonCancel'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/button-cancel.png'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'openRedpacket'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/open-redpacket.png'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/open.png'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'redpacketResult'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/redpacket-result.png'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'buttonContinue'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/button-continue.png'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'buttonUseTicket'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/button-use-ticket.png'</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">spritesheet</span><span class="token punctuation">(</span><span class="token string">'cursorAnimation'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/cursor-animation.png'</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 手势动画，两帧</span>
    game<span class="token punctuation">.</span>load<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string">'gameStartBtn'</span><span class="token punctuation">,</span> <span class="token string">'assets/img/anniu.png'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="创建游戏画布"><a href="#创建游戏画布" class="header-anchor">#</a> 创建游戏画布</h3> <p>游戏加载完毕呈现的是启动页，等待用户做好准备，随时开始游戏，在页面底部绘制一个开始游戏按钮，当用户准备好后，点击开始游戏按钮，切换到红包雨执行页。</p> <p>画布创建初始期间需要提前预设好物理引擎类型，同时设置全部物理元素的重力为2000。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// 创建游戏画布，在游戏完全加载后立即执行</span>
<span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 物理系统</span>
  game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span><span class="token function">startSystem</span><span class="token punctuation">(</span>Phaser<span class="token punctuation">.</span>Physics<span class="token punctuation">.</span><span class="token constant">ARCADE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  game<span class="token punctuation">.</span>physics<span class="token punctuation">.</span>arcade<span class="token punctuation">.</span>gravity<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>

  <span class="token comment">// 背景图</span>
  <span class="token keyword">let</span> launchBg <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'launchBg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  launchBg<span class="token punctuation">.</span>width <span class="token operator">=</span> game<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
  launchBg<span class="token punctuation">.</span>height <span class="token operator">=</span> game<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

  <span class="token comment">// 开始按钮背景</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>gameStartButton <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX<span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>gameHeight <span class="token operator">-</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token string">&quot;gameStartBtn&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gameStartButton<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gameStartText<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cursorHandle<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>gameStartButton<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token comment">// 游戏开始文案</span>
  <span class="token keyword">const</span> gameStartTextStyle <span class="token operator">=</span> <span class="token punctuation">{</span> fill<span class="token operator">:</span> <span class="token string">'#FFF'</span><span class="token punctuation">,</span> fontSize<span class="token operator">:</span> <span class="token string">'30px'</span><span class="token punctuation">,</span> fontWeight<span class="token operator">:</span> <span class="token string">'bolder'</span> <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>gameStartText <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX<span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>gameHeight <span class="token operator">-</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token string">'开始游戏'</span><span class="token punctuation">,</span> gameStartTextStyle<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>gameStartText<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>

  <span class="token comment">// 手指</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cursorHandle <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX <span class="token operator">-</span> <span class="token number">36</span><span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>gameHeight <span class="token operator">-</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token string">'cursorAnimation'</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cursorHandle<span class="token punctuation">.</span>animations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'cursorAnimation'</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cursorHandle<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">'cursorAnimation'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="创建游戏元素"><a href="#创建游戏元素" class="header-anchor">#</a> 创建游戏元素</h3> <p>当用户点击开始游戏按钮后，会隐藏启动页，展示游戏页，游戏页包含背景图、计时器、退出游戏按钮、红包雨。</p> <p>其中红包雨用到了<code>createMultiple</code>方法，会重复绘制出新的红包精灵，设置了一次性最多绘制数量为10。每次绘制出来新的红包精灵都需要更新新的帧，从而展示到舞台中，这时用到了<code>game.time.events.loop</code>方法，我设置了让舞台0.15秒更新一帧，更新的频率比较快，绘制呈现的红包就比较多，如果每1秒钟绘制一帧的话，红包数量显得太少。</p> <p>以上元素均需要在此时绘制生成并立即展示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// 开始游戏</span>
  <span class="token function">startGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 启动游戏进行中音效</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gameAudio <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'playing'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gameAudio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gameAudio<span class="token punctuation">.</span><span class="token function-variable function">onended</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>gameAudio<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 重新播放</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>gameAudio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 红包雨背景图</span>
    <span class="token keyword">let</span> bgRainer <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'bgRainer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bgRainer<span class="token punctuation">.</span>width <span class="token operator">=</span> game<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    bgRainer<span class="token punctuation">.</span>height <span class="token operator">=</span> game<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> gameOptions<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>redPacketGroup <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>redPacketGroup<span class="token punctuation">.</span>enableBody <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>redPacketGroup<span class="token punctuation">.</span><span class="token function">createMultiple</span><span class="token punctuation">(</span>gameOptions<span class="token punctuation">.</span>selfPool<span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>selfPic<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建许多红包</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>redPacketGroup<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span><span class="token string">'anchor.y'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>redPacketGroup<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span><span class="token string">'outOfBoundsKill'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>redPacketGroup<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span><span class="token string">'checkWorldBounds'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    game<span class="token punctuation">.</span>time<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">loop</span><span class="token punctuation">(</span>Phaser<span class="token punctuation">.</span>Timer<span class="token punctuation">.</span><span class="token constant">SECOND</span> <span class="token operator">*</span> gameOptions<span class="token punctuation">.</span>rate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>createRedPacket<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化游戏时间</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>leftTime <span class="token operator">=</span> gameOptions<span class="token punctuation">.</span>time
    <span class="token comment">// 剩余时间文案</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>leftTimeText <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>leftTime<span class="token punctuation">,</span> <span class="token punctuation">{</span> fill<span class="token operator">:</span> <span class="token string">'#FFF'</span><span class="token punctuation">,</span> fontSize<span class="token operator">:</span> <span class="token string">'40px'</span><span class="token punctuation">,</span> fontWeight<span class="token operator">:</span> <span class="token string">'bolder'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>leftTimeText<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span><span class="token function">rfuc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>leftTimeText<span class="token punctuation">.</span>fixedToCamera <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>leftTimeText<span class="token punctuation">.</span>cameraOffset<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token function">rfuc</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rfuc</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 重复切换帧，第一个参数是一帧间隔时长</span>
    game<span class="token punctuation">.</span>time<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>Phaser<span class="token punctuation">.</span>Timer<span class="token punctuation">.</span><span class="token constant">SECOND</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>leftTime<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refreshTime<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>

    <span class="token comment">// 添加右上角退出游戏按钮</span>
    game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token function">rfuc</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rfuc</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>showExitDialog<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>

    <span class="token comment">// 创建退出游戏对话框</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createExitDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="红包雨构建"><a href="#红包雨构建" class="header-anchor">#</a> 红包雨构建</h3> <p>每个红包来源于<code>this.redPacketGroup</code>组，从中选取第一个精灵，设置其物理属性。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// 创建红包</span>
  <span class="token function">createRedPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> redPacket <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>redPacketGroup<span class="token punctuation">.</span><span class="token function">getFirstExists</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从组里抽取一个精灵元素</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>redPacket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      redPacket<span class="token punctuation">.</span>events<span class="token punctuation">.</span>onInputDown<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      redPacket<span class="token punctuation">.</span><span class="token function">loadTexture</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>selfPic<span class="token punctuation">)</span>
      redPacket<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 设置透明度为1</span>
      redPacket<span class="token punctuation">.</span>angle <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 红包旋转角度</span>
      redPacket<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>rnd<span class="token punctuation">.</span><span class="token function">integerInRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>gameWidth <span class="token operator">-</span> <span class="token number">144</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//红包生成的位置</span>
      redPacket<span class="token punctuation">.</span>body<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>x <span class="token operator">=</span> game<span class="token punctuation">.</span>rnd<span class="token punctuation">.</span><span class="token function">integerInRange</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//红包移动的速度</span>
      redPacket<span class="token punctuation">.</span>body<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>y <span class="token operator">=</span> game<span class="token punctuation">.</span>rnd<span class="token punctuation">.</span><span class="token function">integerInRange</span><span class="token punctuation">(</span>gameOptions<span class="token punctuation">.</span>minSpeed<span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>maxSpeed<span class="token punctuation">)</span><span class="token punctuation">;</span>
      redPacket<span class="token punctuation">.</span>inputEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      redPacket<span class="token punctuation">.</span>events<span class="token punctuation">.</span>onInputDown<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>hitRedPacket<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// 添加点击事件</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="点击红包"><a href="#点击红包" class="header-anchor">#</a> 点击红包</h3> <p>红包雨下落过程中可以点击红包，红包被点击中后，会展示瓦片精灵第二帧的图（被选中的图）。图展示完毕，开始执行精灵销毁操作，销毁操作可以增加补间动画，让销毁的过程更加美观，这里为了性能考虑没有使用销毁补间动画，每一次红包销毁使用补间动画都会增加极大的性能消耗。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// 点击红包</span>
  <span class="token function">hitRedPacket</span><span class="token punctuation">(</span><span class="token parameter">sprite</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 选中的红包设置为不可点击</span>
    sprite<span class="token punctuation">.</span>inputEnabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// 给红包添加帧动画</span>
    <span class="token keyword">let</span> anim <span class="token operator">=</span> sprite<span class="token punctuation">.</span>animations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>gameOptions<span class="token punctuation">.</span>selfPic<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行帧动画</span>
    sprite<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>gameOptions<span class="token punctuation">.</span>selfPic<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 帧动画切换完毕后，执行补间动画，让红包渐变消失</span>
    anim<span class="token punctuation">.</span>onComplete<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>killed<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> sprite<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="游戏结束"><a href="#游戏结束" class="header-anchor">#</a> 游戏结束</h3> <p>当计时器结束时，代表游戏结束，展示开奖对话框，用户点击弹框金币，执行开奖。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// 展示奖励</span>
  <span class="token function">showAwardDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardGourp <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardResultGroup <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//背景</span>
    <span class="token keyword">const</span> hexGraphics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phaser<span class="token punctuation">.</span>Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beginFill</span><span class="token punctuation">(</span><span class="token number">0x000000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 遮罩</span>
    <span class="token keyword">const</span> pausedMask <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> hexGraphics<span class="token punctuation">.</span><span class="token function">generateTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 对话框背景图</span>
    <span class="token keyword">const</span> openDialog <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX<span class="token punctuation">,</span> game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerY<span class="token punctuation">,</span> <span class="token string">'openRedpacket'</span><span class="token punctuation">)</span>
    openDialog<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token comment">// 开奖硬币图</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardCoin <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX<span class="token punctuation">,</span> game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerY <span class="token operator">+</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleOpenCoin</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardCoin<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token comment">// 支持点击</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardCoin<span class="token punctuation">.</span>inputEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// 将上面添加进组里，方便统一管理</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardGourp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pausedMask<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardGourp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>openDialog<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardGourp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>showAwardCoin<span class="token punctuation">)</span>

    <span class="token comment">// 结果背景图</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">sprite</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX<span class="token punctuation">,</span> game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerY<span class="token punctuation">,</span> <span class="token string">'redpacketResult'</span><span class="token punctuation">)</span>
    result<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token comment">// 去用券按钮</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardUserTicket <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX <span class="token operator">-</span> <span class="token number">130</span><span class="token punctuation">,</span> game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerY <span class="token operator">+</span> <span class="token number">310</span><span class="token punctuation">,</span> <span class="token string">'buttonUseTicket'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleAwardDialogBtn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardUserTicket<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token comment">// 继续抢按钮</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardGoOn <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX <span class="token operator">+</span> <span class="token number">130</span><span class="token punctuation">,</span> game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerY <span class="token operator">+</span> <span class="token number">310</span><span class="token punctuation">,</span> <span class="token string">'buttonContinue'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleAwardDialogBtn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardGoOn<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token comment">// 将上面添加进组里，方便统一管理</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardResultGroup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardResultGroup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>showAwardUserTicket<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardResultGroup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>showAwardGoOn<span class="token punctuation">)</span>
    <span class="token comment">// 先设置抽奖结果为隐藏</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardResultGroup<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="开奖结果"><a href="#开奖结果" class="header-anchor">#</a> 开奖结果</h3> <p>奖品提示文案可以根据实际业务情况进行修改。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">// 显示开奖结果</span>
  <span class="token function">getAwardResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'audioOpen'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> ticketStyle <span class="token operator">=</span> <span class="token punctuation">{</span> fill<span class="token operator">:</span> <span class="token string">'#ffe67d'</span><span class="token punctuation">,</span> fontSize<span class="token operator">:</span> <span class="token string">'46px'</span><span class="token punctuation">,</span> fontWeight<span class="token operator">:</span> <span class="token string">'bolder'</span> <span class="token punctuation">}</span>
    <span class="token keyword">let</span> ticketText <span class="token operator">=</span> game<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX<span class="token punctuation">,</span> game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerY <span class="token operator">+</span> <span class="token number">75</span><span class="token punctuation">,</span> gameOptions<span class="token punctuation">.</span>awardText<span class="token punctuation">,</span> ticketStyle<span class="token punctuation">)</span> <span class="token comment">// 奖励结果文案</span>
    ticketText<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    ticketText<span class="token punctuation">.</span>left <span class="token operator">=</span> game<span class="token punctuation">.</span>world<span class="token punctuation">.</span>centerX <span class="token operator">-</span> ticketText<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token comment">// 文字居中</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardResultGroup<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ticketText<span class="token punctuation">)</span> <span class="token comment">// 添加进结果组里</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardGourp<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 隐藏开奖前对话框</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>showAwardResultGroup<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 显示开奖结果对话框</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>以上即为整个游戏的流程。</p> <ul><li>红包使用<code>spritesheet</code>精灵图，通过切换画布帧的方式展示未被选中和已被选择两种红包图。</li> <li>红包下落的速度由<code>Phaser.Physics.ARCADE</code>物理引擎的<code>gravity</code>重力和<code>velocity</code>速度决定。</li> <li>启动页和游戏页绘制成的画布由<code>visible</code>属性控制显示和隐藏，启动页点击开始游戏后使启动页所有画布隐藏，等游戏结束后，设置其为显示（设置<code>visible</code>为<code>true</code>）</li> <li>游戏页面左上角有一个关闭按钮，在游戏运行过程中，支持退出游戏和继续游戏操作</li> <li>游戏结束后展示开奖对话框，用户点击游戏币会执行补间动画，摇动游戏币，1秒钟后展示开奖结果</li> <li>游戏重新开始，要重置计时器时间、计时器文案和一些必要的业务逻辑（构造函数的变量都存储在<code>game</code>对象作用域链），执行<code>game.state.restart()</code>方法重新开始游戏不会重置作用域链中自己定义的变量。</li> <li>为适配不同尺寸设备，以374px为设计基准，以屏幕视口宽度为实际尺寸，利用公式：设计稿比例 * 视口宽度 / 375 得到实际绘制的元素尺寸。</li> <li>游戏中的音效全部使用<code>audio</code>标签，音效播放、暂停、重播等操作均使用<code>audio</code>原生API</li></ul> <p><a href="https://codesandbox.io/s/nervous-frog-l2tmm?file=/main.js" target="_blank" rel="noopener noreferrer">游戏试玩<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://gitee.com/smallzip/red-packet-rain" target="_blank" rel="noopener noreferrer">项目地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.dev/jianpiao/red-packet-rain" target="_blank" rel="noopener noreferrer">在线代码阅读<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="参考文献"><a href="#参考文献" class="header-anchor">#</a> 参考文献</h2> <p><a href="https://github.com/AmosXu/red-packet-rain" target="_blank" rel="noopener noreferrer">红包雨素材<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://phaser.io/docs/2.6.2/Phaser.Group.html" target="_blank" rel="noopener noreferrer">phaser官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.aigei.com/s?q=%E9%A2%86%E7%BA%A2%E5%8C%85&amp;type=sound_category" target="_blank" rel="noopener noreferrer">爱给网音效<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/12/2022, 5:47:05 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javascript设计模式.html" class="prev">
        javascript设计模式
      </a></span> <span class="next"><a href="/phaser/消消乐.html">
        消消乐
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7d4f3de2.js" defer></script><script src="/assets/js/2.26b4ca92.js" defer></script><script src="/assets/js/44.d04f9b22.js" defer></script>
  </body>
</html>
