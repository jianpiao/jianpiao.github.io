# 计算机基础笔记

计算机基础原理、学习内容做一下笔记

### 进程和线程

* 进程是系统资源分配、调度和管理的最小单位
* 线程是cpu运算的最小执行单位



#### 进程概述

我们知道文件是对I/O设备的抽象，虚拟存储器是对文件和主存的抽象，指令集是对CPU的抽象，进程是对指令集和虚拟存储器的抽象。

![img](https://user-gold-cdn.xitu.io/2018/4/20/162e0940cbe7782f?imageslim)



#### 虚拟内存的逻辑布局

虚拟内存包括用户栈、堆、程序数据和程序代码，程序数据和程序代码从可执行文件加载而来的。

![img](https://user-gold-cdn.xitu.io/2018/4/20/162e0940cec14767?imageslim)

此时，CPU运行到地址为304的指令， 假设CPU时间片刚好用完，就需要进行进程切换，在进行进程切换之前，需要保护现场，即保存寄存器信息、PC、打开的文件， 代码段地址、数据地址、堆栈信息等，这些信息称为**进程的上下文**。当操作系统切换到进程时，首先将进程2的上下文信息加载到操作系统中，找到PC，然后接着执行就可以了。

#### 进程控制块PCB

进程的上下文信息是以某个数据结构保存在内存中的，而这种数据结构就是PCB。在Linux操作系统中PCB对应的数据结构就是task_struct，它保存着进程的重要信息。

```javascript
struct task_struct{
  pid_t pid://进程号
  long state;//状态
  cputime_t utime,stime;//cpu在用户态和 核心态下执行的时间
  struct files_struct *files;//打开的文件
  struct   mm_struct  *mm;//进程使用的内存
  ...
}
```



#### node线程

node并不是单线程的，因为node是使用的c++写的，所以底层c++在实现的时候使用了多线程来处理，我们用户能够操作的是单线程的。



#### 线程的五中状态

![image-20210130150503751](/Users/smallzip/Library/Application Support/typora-user-images/image-20210130150503751.png)

* 初始化(New)：初始化状态，可以理解为实例
* 可运行(Runnable)：可运行是说明实例化正常了，可以看做thread.start
* 阻塞(Blocked)：线程阻塞，不占用cpu资源
* 运行中(Running)：可运行之后抢占到了cpu执行
* 销毁(Dead)：线程销毁

以上五中状态只有运行中会占用到cpu资源的。

##### 流程

我们来介绍了一下五个状态的流程是怎么样的。

首先进程会被创建，然后进入到可运行状态，此时，进程并没有进入到运行状态，而是等待CPU调度，如果被CPU调度则进入到运行状态，而当时间片用完时，进程从运行状态返回到可运行状态，而当等待I/O操作时，则由运行态进入阻塞态。

#### CPU调度

如上所述，**CPU调度就是到底哪个线程占有CPU**，它可以分为**非抢占式**和**抢占式**。非抢占式是指调度程序一旦把CPU分配给某一进程后便让它一直运行下去，直到进程完成或发生某件事件而不能运行时，才将CPU分配给其他线程。它适合批处理系统，简单、系统开销小。抢占式是指当一个线程正在执行时，系统可以基于某种策略剥夺CPU给其他进程。剥夺的原则有优先权原则、端进程优先原则、时间片原则，它适用于交互式系统。

#### 线程创建、销毁和切换

